{"version":3,"file":"index.js","sources":["../../node_modules/@babel/runtime/helpers/classCallCheck.js","../../node_modules/@babel/runtime/helpers/defineProperty.js","../../node_modules/@babel/runtime/helpers/createClass.js","../share/storage.js","../share/index.js","dev/index.js"],"sourcesContent":["function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","export default class Storage {\n    constructor(name, isLocal = true) {\n        this.name = name;\n        this.storage = isLocal ? localStorage : sessionStorage;\n    }\n\n    get(key) {\n        const storage = JSON.parse(this.storage.getItem(this.name)) || {};\n        return key ? storage[key] : storage;\n    }\n\n    set(key, value) {\n        const storage = { ...this.get(), [key]: value };\n        this.storage.setItem(this.name, JSON.stringify(storage));\n    }\n\n    del(key) {\n        const storage = this.get();\n        delete storage[key];\n        this.storage.setItem(this.name, JSON.stringify(storage));\n    }\n\n    clean() {\n        this.storage.removeItem(this.name);\n    }\n}\n","export function sleep(ms = 0) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nexport function download(url, name) {\n    const elink = document.createElement('a');\n    elink.style.display = 'none';\n    elink.href = url;\n    elink.download = name;\n    document.body.appendChild(elink);\n    elink.click();\n    document.body.removeChild(elink);\n}\n\nexport function getActiveTab() {\n    return new Promise(resolve => {\n        chrome.tabs.query(\n            {\n                active: true,\n                currentWindow: true,\n            },\n            tabs => {\n                resolve(tabs[0]);\n            },\n        );\n    });\n}\n","import './index.scss';\nimport Storage from '../../share/storage';\nimport { getActiveTab } from '../../share';\n\nclass Popup {\n    constructor() {\n        const storage = new Storage('popup');\n        const live = storage.get('live');\n        const config = storage.get('config');\n        const manifest = chrome.runtime.getManifest();\n        const $container = document.querySelector('.container');\n        const $name = document.querySelector('.name');\n        const $feedback = document.querySelector('.feedback');\n        const $tab = document.querySelector('.tab');\n        const $rtmpUrl = document.querySelector('.rtmpUrl');\n        const $liveUrl = document.querySelector('.liveUrl');\n        const $resolution = document.querySelector('.resolution');\n        const $frameRate = document.querySelector('.frameRate');\n        const $bitsPerSecond = document.querySelector('.bitsPerSecond');\n        const $info = document.querySelector('.info');\n        const $start = document.querySelector('.start');\n        const $stop = document.querySelector('.stop');\n\n        $name.textContent = `${manifest.name} ${manifest.version}`;\n\n        $name.addEventListener('click', () => {\n            chrome.tabs.create({ url: 'https://chrome.google.com/webstore/detail/nagmkdppcmenlcgelpgkjoknakghllml' });\n        });\n\n        $feedback.addEventListener('click', () => {\n            chrome.tabs.create({ url: 'https://github.com/zhw2590582/bilibili-live-hime' });\n        });\n\n        getActiveTab().then(tab => {\n            $tab.value = `${tab.title} - ${tab.url}`;\n            if (config) {\n                $rtmpUrl.value = config.rtmpUrl;\n                $liveUrl.value = config.liveUrl;\n                $resolution.value = config.resolution;\n                $frameRate.value = config.frameRate;\n                $bitsPerSecond.value = config.bitsPerSecond;\n            }\n            if (live) {\n                $tab.value = config.tab;\n                $container.classList.add('live');\n            }\n        });\n\n        function info(msg) {\n            $info.style.display = 'block';\n            $info.textContent = msg;\n        }\n\n        function start() {\n            const tab = $tab.value.trim();\n            const rtmpUrl = $rtmpUrl.value.trim();\n            const liveUrl = $liveUrl.value.trim();\n            const resolution = $resolution.value.trim();\n            const frameRate = $frameRate.value.trim();\n            const bitsPerSecond = $bitsPerSecond.value.trim();\n            if (!rtmpUrl || !rtmpUrl.startsWith($rtmpUrl.placeholder)) {\n                return info('请输入正确的 rtmp 推流地址');\n            }\n            if (!liveUrl || !liveUrl.startsWith($liveUrl.placeholder)) {\n                return info('请输入正确的 https 直播地址');\n            }\n            $info.style.display = 'none';\n            $container.classList.add('live');\n            storage.set('live', true);\n            chrome.tabs.create({ url: liveUrl });\n            const configData = {\n                tab,\n                rtmpUrl,\n                liveUrl,\n                resolution,\n                frameRate,\n                bitsPerSecond,\n            };\n            storage.set('config', configData);\n            chrome.runtime.sendMessage({\n                type: 'start',\n                data: configData,\n            });\n        }\n\n        function stop() {\n            $container.classList.remove('live');\n            storage.del('live', true);\n            chrome.runtime.sendMessage({\n                type: 'stop',\n            });\n        }\n\n        $start.addEventListener('click', start);\n        $stop.addEventListener('click', stop);\n    }\n}\n\nexport default new Popup();\n"],"names":["Storage","name","isLocal","storage","localStorage","sessionStorage","key","JSON","parse","getItem","value","get","setItem","stringify","removeItem","getActiveTab","Promise","resolve","chrome","tabs","query","active","currentWindow","Popup","live","config","manifest","runtime","getManifest","$container","document","querySelector","$name","$feedback","$tab","$rtmpUrl","$liveUrl","$resolution","$frameRate","$bitsPerSecond","$info","$start","$stop","textContent","version","addEventListener","create","url","then","tab","title","rtmpUrl","liveUrl","resolution","frameRate","bitsPerSecond","classList","add","info","msg","style","display","start","trim","startsWith","placeholder","set","configData","sendMessage","type","data","stop","remove","del"],"mappings":"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"}