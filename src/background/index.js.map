{"version":3,"file":"index.js","sources":["../../node_modules/@babel/runtime/helpers/classCallCheck.js","../../node_modules/crx-hotreload/hot-reload.js","../../node_modules/csp-generator/dist/csp-generator.js","dev/changeCSP.js","../../node_modules/@babel/runtime/helpers/createClass.js","dev/capture.js","dev/index.js"],"sourcesContent":["function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","const filesInDirectory = dir => new Promise (resolve =>\n\n    dir.createReader ().readEntries (entries =>\n\n        Promise.all (entries.filter (e => e.name[0] !== '.').map (e =>\n\n            e.isDirectory\n                ? filesInDirectory (e)\n                : new Promise (resolve => e.file (resolve))\n        ))\n        .then (files => [].concat (...files))\n        .then (resolve)\n    )\n)\n\nconst timestampForFilesInDirectory = dir =>\n        filesInDirectory (dir).then (files =>\n            files.map (f => f.name + f.lastModifiedDate).join ())\n\nconst reload = () => {\n\n    chrome.tabs.query ({ active: true, currentWindow: true }, tabs => { // NB: see https://github.com/xpl/crx-hotreload/issues/5\n\n        if (tabs[0]) { chrome.tabs.reload (tabs[0].id) }\n\n        chrome.runtime.reload ()\n    })\n}\n\nconst watchChanges = (dir, lastTimestamp) => {\n\n    timestampForFilesInDirectory (dir).then (timestamp => {\n\n        if (!lastTimestamp || (lastTimestamp === timestamp)) {\n\n            setTimeout (() => watchChanges (dir, timestamp), 1000) // retry after 1s\n\n        } else {\n\n            reload ()\n        }\n    })\n\n}\n\nchrome.management.getSelf (self => {\n\n    if (self.installType === 'development') {\n\n        chrome.runtime.getPackageDirectoryEntry (dir => watchChanges (dir))\n    }\n})\n","/*!\n * csp-generator.js v1.0.2\n * Github: https://github.com/zhw2590582/csp-generator#readme\n * (c) 2017-2019 Harvey Zack\n * Released under the MIT License.\n */\n\n!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define(t):(e=e||self).CSP=t()}(this,function(){\"use strict\";var n=function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")};function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var e=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};return function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:\"\";n(this,t),this.csp=this.parse(e)}return e(t,[{key:\"parse\",value:function(e){return(0<arguments.length&&void 0!==e?e:\"\").split(\";\").reduce(function(e,t){var n=t.split(\" \").filter(function(e){return e.trim()}),i=n[0],r=n.slice(1);return e[i]=r,e},{})}},{key:\"generate\",value:function(){var n=this;return Object.keys(this.csp).reduce(function(e,t){return\"\".concat(e,\" \").concat(t,\" \").concat(n.csp[t].join(\" \"),\";\")},\"\").trim()}},{key:\"append\",value:function(e,t){return this.csp[e]&&-1===this.csp[e].indexOf(t)?this.csp[e].push(t):this.csp[e]=[t],this}},{key:\"delete\",value:function(e,t){if(t){var n=(this.csp[e]||[]).indexOf(t);-1<n&&this.csp[e].splice(n,1)}else delete this.csp[e];return this}},{key:\"get\",value:function(e){return this.csp[e]}}]),t}()});\n","import CSP from 'csp-generator';\n\nexport default class ChangeCSP {\n    constructor() {\n        const manifest = chrome.runtime.getManifest();\n        chrome.webRequest.onHeadersReceived.addListener(\n            details => {\n                const header = details.responseHeaders.find(event => {\n                    const name = event.name.toLowerCase();\n                    return name === 'content-security-policy-report-only' || name === 'content-security-policy';\n                });\n\n                if (header && header.value) {\n                    const csp = new CSP(header.value);\n                    csp.append('worker-src', 'blob:');\n                    csp.append('script-src', '*.baidu.com');\n                    csp.append('img-src', '*.baidu.com');\n                    header.value = csp.generate();\n                }\n\n                return { responseHeaders: details.responseHeaders };\n            },\n            { urls: manifest.content_scripts[0].matches },\n            ['blocking', 'responseHeaders'],\n        );\n    }\n}\n","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","export default class Capture {\n    constructor(bg) {\n        this.bg = bg;\n        this.ms = null;\n    }\n\n    static get constraints() {\n        return {\n            audio: true,\n            video: true,\n            videoConstraints: {\n                mandatory: {\n                    chromeMediaSource: 'tab',\n                    maxWidth: 3840,\n                    maxHeight: 2160,\n                },\n            },\n            audioConstraints: {\n                mandatory: {\n                    echoCancellation: true,\n                },\n            },\n        };\n    }\n\n    tabCapture() {\n        chrome.tabCapture.capture(Capture.constraints, stream => {\n            this.ms = new MediaStream();\n            stream.getTracks().forEach(track => {\n                console.log(track);\n                this.ms.addTrack(track);\n            });\n        });\n    }\n}\n","import 'crx-hotreload';\nimport ChangeCSP from './changeCSP';\nimport Capture from './capture';\n\nclass Background {\n    constructor() {\n        this.changeCSP = new ChangeCSP(this);\n        this.capture = new Capture(this);\n\n        chrome.runtime.onMessage.addListener(request => {\n            switch (request.type) {\n                case 'start':\n                    console.log('start');\n                    break;\n                case 'stop':\n                    console.log('stop');\n                    break;\n                default:\n                    break;\n            }\n        });\n    }\n}\n\nexport default new Background();\n"],"names":["this","ChangeCSP","manifest","chrome","runtime","getManifest","webRequest","onHeadersReceived","addListener","details","header","responseHeaders","find","event","name","toLowerCase","value","csp","CSP","append","generate","urls","content_scripts","matches","Capture","bg","ms","tabCapture","capture","constraints","stream","MediaStream","getTracks","forEach","track","console","log","addTrack","audio","video","videoConstraints","mandatory","chromeMediaSource","maxWidth","maxHeight","audioConstraints","echoCancellation","Background","changeCSP","onMessage","request","type"],"mappings":"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"}