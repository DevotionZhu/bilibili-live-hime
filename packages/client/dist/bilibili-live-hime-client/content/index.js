/*!
 * bilibili-live-hime v1.0.1
 * Github: https://github.com/zhw2590582/bilibili-live-hime
 * (c) 2018-2019 Harvey Zack
 * Released under the MIT License.
 */

var BilibiliLiveHimeContent=function(){"use strict";var n=function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")};function t(n,t){for(var e=0;e<t.length;e++){var i=t[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}var e=function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n};function i(n){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:document).querySelector(n)}return new(function(){function t(){n(this,t),i(".blh-danmuku")||(this.createUI(),this.eventBind(),this.receiveDanmu())}return e(t,[{key:"createUI",value:function(){this.manifest=chrome.runtime.getManifest(),this.$danmuku=document.createElement("div"),this.$danmuku.classList.add("blh-danmuku"),this.$danmuku.innerHTML='\n            <div class="blh-header">\n                <div class="blh-header-l"></div>\n                <div class="blh-header-r">×</div>\n            </div>\n            <div class="blh-danmu">\n                <div class="blh-danmu-inner"></div>\n            </div>\n            <div class="blh-gift">\n                <div class="blh-gift-inner"></div>\n            </div>\n            <div class="blh-footer"></div>\n        ',this.$headL=i(".blh-header-l",this.$danmuku),this.$headR=i(".blh-header-r",this.$danmuku),this.$danmu=i(".blh-danmu",this.$danmuku),this.$danmuInner=i(".blh-danmu-inner",this.$danmuku),this.$gift=i(".blh-gift",this.$danmuku),this.$giftInner=i(".blh-gift-inner",this.$danmuku),this.$footer=i(".blh-footer",this.$danmuku),this.$headL.textContent="".concat(this.manifest.name," ").concat(this.manifest.version),document.body.appendChild(this.$danmuku),this.$icon=document.createElement("div"),this.$icon.classList.add("blh-danmuku-icon"),this.$icon.textContent="弹",document.body.appendChild(this.$icon)}},{key:"eventBind",value:function(){var n=this,t=!1,e=!1,i=0,a=0,s=0,d=0,u=0;this.$headL.addEventListener("mousedown",(function(e){t=!0,i=e.pageX,a=e.pageY,s=n.$danmuku.offsetLeft,d=n.$danmuku.offsetTop})),this.$footer.addEventListener("mousedown",(function(t){e=!0,a=t.pageY,u=n.$danmu.clientHeight})),document.addEventListener("mousemove",(function(s){if(t){var d=s.pageX-i,c=s.pageY-a;n.$danmuku.style.transform="translate(".concat(d,"px, ").concat(c,"px)")}if(e){var o=u+s.pageY-a;o>=100?n.$danmu.style.height="".concat(o,"px"):e=!1}s.composedPath().indexOf(n.$danmuku)>-1?n.isHover=!0:n.isHover=!1})),document.addEventListener("mouseup",(function(u){if(t){t=!1,n.$danmuku.style.transform="translate(0, 0)";var c=s+u.pageX-i,o=d+u.pageY-a;n.$danmuku.style.left="".concat(c,"px"),n.$danmuku.style.top="".concat(o,"px")}e&&(e=!1)})),this.$headR.addEventListener("click",(function(){n.$danmuku.style.display="none",n.$icon.style.display="block"})),this.$icon.addEventListener("click",(function(){n.$danmuku.style.display="block",n.$icon.style.display="none"}))}},{key:"addDanmu",value:function(n){var t=this.$danmuInner.children;if(t.length>50){var e=t[0];i(".blh-danmu-uname",e).innerText="".concat(n.uname,":"),i(".blh-danmu-text",e).innerText=n.text,this.$danmuInner.appendChild(e)}else this.$danmuInner.insertAdjacentHTML("beforeend",'\n                <div class="blh-danmu-item">\n                    <span class="blh-danmu-uname">'.concat(n.uname,':</span>\n                    <span class="blh-danmu-text">').concat(n.text,"</span>\n                </div>\n            "));this.isHover||this.$danmu.scrollTo(0,this.$danmu.scrollHeight)}},{key:"addGift",value:function(n){var t=this.$giftInner.children;if(t.length>50){var e=t[0];i(".blh-gift-uname",e).innerText="".concat(n.uname,":"),i(".blh-gift-action",e).innerText=n.action,i(".blh-gift-gift",e).innerText=n.gift,i(".blh-gift-count",e).innerText=n.count,this.$giftInner.appendChild(e)}else this.$giftInner.insertAdjacentHTML("beforeend",'\n                <div class="blh-gift-item">\n                    <span class="blh-gift-uname">'.concat(n.uname,':</span>\n                    <span class="blh-gift-action">').concat(n.action,'</span>\n                    <span class="blh-gift-gift">').concat(n.gift,'</span>\n                    <span class="blh-gift-count">').concat(n.count,"</span>\n                </div>\n            "));this.isHover||this.$gift.scrollTo(0,this.$gift.scrollHeight)}},{key:"receiveDanmu",value:function(){var n=this;chrome&&chrome.runtime.onMessage.addListener((function(t){var e=t.type,i=t.data;switch(window.postMessage(t),e){case"danmu":n.addDanmu(i);break;case"gift":case"guard":n.addGift(i)}}))}}]),t}())}();
