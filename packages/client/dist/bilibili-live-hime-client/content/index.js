/*!
 * bilibili-live-hime v1.0.1
 * Github: https://github.com/zhw2590582/bilibili-live-hime
 * (c) 2018-2019 Harvey Zack
 * Released under the MIT License.
 */

var BilibiliLiveHimeContent=function(){"use strict";var n=function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")};function e(n,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}}var t=function(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n};function a(n){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:document).querySelector(n)}return new(function(){function e(){n(this,e),a(".blh-danmuku")||(this.createUI(),this.eventBind(),this.receiveDanmu())}return t(e,[{key:"createUI",value:function(){this.$danmuku=document.createElement("div"),this.$danmuku.classList.add("blh-danmuku"),this.$danmuku.innerHTML='\n            <div class="blh-header">\n                <div class="blh-header-l"></div>\n                <div class="blh-header-r">Ã—</div>\n            </div>\n            <div class="blh-danmu">\n                <div class="blh-danmu-inner"></div>\n            </div>\n            <div class="blh-gift">\n                <div class="blh-gift-inner"></div>\n            </div>\n            <div class="blh-footer"></div>\n        ',this.$headL=a(".blh-header-l",this.$danmuku),this.$headR=a(".blh-header-r",this.$danmuku),this.$danmu=a(".blh-danmu",this.$danmuku),this.$danmuInner=a(".blh-danmu-inner",this.$danmuku),this.$gift=a(".blh-gift",this.$danmuku),this.$giftInner=a(".blh-gift-inner",this.$danmuku),this.$footer=a(".blh-footer",this.$danmuku),document.body.appendChild(this.$danmuku)}},{key:"eventBind",value:function(){var n=this,e=!1,t=!1,a=0,i=0,s=0,d=0,u=0;this.$headL.addEventListener("mousedown",(function(t){e=!0,a=t.pageX,i=t.pageY,s=n.$danmuku.offsetLeft,d=n.$danmuku.offsetTop,u=n.$danmu.clientHeight})),this.$footer.addEventListener("mousedown",(function(n){t=!0,i=n.pageY})),document.addEventListener("mousemove",(function(s){if(e){var d=s.pageX-a,c=s.pageY-i;n.$danmuku.style.transform="translate(".concat(d,"px, ").concat(c,"px)")}if(t){var r=u+s.pageY-i;r>=100?n.$danmu.style.height="".concat(r,"px"):t=!1}s.composedPath().indexOf(n.$danmuku)>-1?n.isHover=!0:n.isHover=!1})),document.addEventListener("mouseup",(function(u){if(e){e=!1,n.$danmuku.style.transform="translate(0, 0)";var c=s+u.pageX-a,r=d+u.pageY-i;n.$danmuku.style.left="".concat(c,"px"),n.$danmuku.style.top="".concat(r,"px")}t&&(t=!1)})),this.$headR.addEventListener("click",(function(){n.$danmuku.classList.add("blh-hidden")}))}},{key:"addDanmu",value:function(n){var e=this.$danmuInner.children;if(e.length>50){var t=e[0];a(".blh-danmu-uname",t).innerText="".concat(n.uname,":"),a(".blh-danmu-text",t).innerText=n.text,this.$danmuInner.appendChild(t)}else this.$danmuInner.insertAdjacentHTML("beforeend",'\n                <div class="blh-danmu-item">\n                    <span class="blh-danmu-uname">'.concat(n.uname,':</span>\n                    <span class="blh-danmu-text">').concat(n.text,"</span>\n                </div>\n            "));this.isHover||this.$danmu.scrollTo(0,this.$danmu.scrollHeight)}},{key:"addGift",value:function(n){var e=this.$giftInner.children;if(e.length>50){var t=e[0];a(".blh-gift-uname",t).innerText="".concat(n.uname,":"),a(".blh-gift-action",t).innerText=n.action,a(".blh-gift-gift",t).innerText=n.gift,a(".blh-gift-count",t).innerText=n.count,this.$giftInner.appendChild(t)}else this.$giftInner.insertAdjacentHTML("beforeend",'\n                <div class="blh-gift-item">\n                    <span class="blh-gift-uname">'.concat(n.uname,':</span>\n                    <span class="blh-gift-action">').concat(n.action,'</span>\n                    <span class="blh-gift-gift">').concat(n.gift,'</span>\n                    <span class="blh-gift-count">').concat(n.count,"</span>\n                </div>\n            "));this.isHover||this.$gift.scrollTo(0,this.$gift.scrollHeight)}},{key:"receiveDanmu",value:function(){var n=this;chrome&&chrome.runtime.onMessage.addListener((function(e){var t=e.type,a=e.data;switch(window.postMessage(e),t){case"danmu":n.addDanmu(a);break;case"gift":case"guard":n.addGift(a)}}))}}]),e}())}();
