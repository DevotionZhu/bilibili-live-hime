{"version":3,"file":"index.js","sources":["dev/index.js"],"sourcesContent":["const $script = document.createElement('script');\n$script.type = 'text/javascript';\n$script.text = `var top = window.parent`;\ndocument.documentElement.appendChild($script);\n// $script.onload = document.documentElement.removeChild($script);\n\nwindow.addEventListener('load', () => {\n    function getSongs() {\n        const $list = document.querySelector('#g_playlist');\n        if (!$list) return [];\n        const $list_ul = $list.querySelector('.f-cb');\n        return Array.from($list_ul.children).map(item => {\n            return {\n                id: Number(item.dataset.id),\n                playing: item.classList.contains('z-sel'),\n                song: item.children[1].innerText.trim(),\n                singer: item.children[3].innerText,\n                duration: item.children[4].innerText,\n            };\n        });\n    }\n\n    function getLyrics() {\n        const $list = document.querySelector('#g_playlist');\n        if (!$list) return [];\n        const $lyrics = $list.querySelector('.listlyric');\n        return Array.from($lyrics.children).map(item => {\n            return {\n                playing: item.classList.contains('z-sel'),\n                time: item.dataset.time,\n                text: item.innerText.trim(),\n            };\n        });\n    }\n\n    setInterval(() => {\n        const $listBtn = document.querySelector('[title=\"播放列表\"]');\n        const $list = document.querySelector('#g_playlist');\n        if (!$list && $listBtn) {\n            $listBtn.click();\n        } else {\n            window.parent.postMessage(\n                {\n                    type: 'MUSIC_163',\n                    data: {\n                        songs: getSongs(),\n                        lyrics: getLyrics(),\n                    },\n                },\n                '*',\n            );\n        }\n    }, 500);\n\n    function order_song(song) {\n        const $iframe = document.querySelector('#g_iframe');\n        const $input = $iframe.contentDocument.querySelector('#m-search-input');\n        const $search = $iframe.contentDocument.querySelector('[title=\"搜索\"]');\n        $input.value = song;\n        $search.click();\n        setTimeout(() => {\n            const $add = $iframe.contentDocument.querySelector('[title=\"添加到播放列表\"');\n            if ($add) {\n                $add.click();\n            }\n        }, 1000);\n    }\n\n    function prev_song() {\n        const $prev = document.querySelector('.prv');\n        $prev.click();\n    }\n\n    function next_song() {\n        const $next = document.querySelector('.nxt');\n        $next.click();\n    }\n\n    function play_song(state) {\n        const $play = document.querySelector('.ply');\n        const playing = $play.dataset.action === 'pause';\n        if ((playing && state) || (!playing && !state)) return;\n        if ((playing && !state) || (!playing && state)) $play.click();\n    }\n\n    function play_mode(mode) {\n        if (!['one', 'loop', 'shuffle'].includes(mode)) return;\n        const $mode = document.querySelector('[data-action=\"mode\"]');\n        (function check() {\n            if (!$mode.classList.contains(`icn-${mode}`)) {\n                $mode.click();\n                setTimeout(check, 100);\n            }\n        })();\n    }\n\n    function clear_song() {\n        const $clear = document.querySelector('.clear');\n        $clear.click();\n    }\n\n    window.addEventListener('message', event => {\n        const { type, data } = event.data;\n        switch (type) {\n            case 'ORDER_SONG':\n                order_song(data);\n                break;\n            case 'PREV_SONG':\n                prev_song();\n                break;\n            case 'NEXT_SONG':\n                next_song();\n                break;\n            case 'PLAY_SONG':\n                play_song(true);\n                break;\n            case 'PAUSE_SONG':\n                play_song(false);\n                break;\n            case 'PLAY_MODE':\n                play_mode(data);\n                break;\n            case 'CLEAR_SONG':\n                clear_song();\n                break;\n            case 'RELOAD':\n                window.location.reload();\n                break;\n            default:\n                break;\n        }\n    });\n});\n"],"names":["$script","document","createElement","type","text","documentElement","appendChild","window","addEventListener","getSongs","$list","querySelector","$list_ul","Array","from","children","map","item","id","Number","dataset","playing","classList","contains","song","innerText","trim","singer","duration","getLyrics","$lyrics","time","setInterval","$listBtn","click","parent","postMessage","data","songs","lyrics","order_song","$iframe","$input","contentDocument","$search","value","setTimeout","$add","prev_song","$prev","next_song","$next","play_song","state","$play","action","play_mode","mode","includes","$mode","check","clear_song","$clear","event","location","reload"],"mappings":"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"}