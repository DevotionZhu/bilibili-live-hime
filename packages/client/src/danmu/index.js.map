{"version":3,"file":"index.js","sources":["../../node_modules/@babel/runtime/helpers/classCallCheck.js","../share/constant.js","dev/index.js"],"sourcesContent":["function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","export const START = 'start';\nexport const STOP = 'stop';\nexport const CONFIG = 'config';\nexport const RECORDING = 'recording';\nexport const DEBUG = 'debug';\nexport const LOG = 'log';\nexport const ERROR = 'error';\nexport const FAIL = 'fail';\nexport const RTMP = 'rtmp';\nexport const RECONNECT = 'reconnect';\nexport const STREAM_DISCONNECT = 'stream_disconnect';\nexport const BINARY_STREAM = 'binary_stream';\nexport const DANMU_OPTION = 'danmu_option';\nexport const DANMU_ERROR = 'danmu_error';\n\nexport const SOCKET_SUCCESS = '建立socket连接成功';\nexport const SOCKET_FAIL = '建立socket连接失败';\nexport const TAB_VIDEO_STREAM_SUCCESS = '获取标签视频流成功';\nexport const TAB_VIDEO_STREAM_FAIL = '无法获取标签视频流，请重试！';\nexport const RECORDER_SUCCESS = '录制器启动成功';\nexport const RECORDER_FAIL = '无法录制标签的视频流，请重试！';\nexport const PUSH_STREAM_ING = '正在推流中...';\nexport const CAN_NOT_FIND_TAB = '未获取到当前激活的标签';\nexport const RTMP_ERROR = '请输入正确的rtmp推流地址';\nexport const STREAM_NAME_ERROR = '请输入正确的直播码';\nexport const SOCKET_ERROR = '请输入正确的中转地址';\nexport const LIVE_ROOM_ERROR = '不是有效的 Bilibili 直播间地址';\nexport const OPEN_SUCCESS = '打开直播间页面成功';\nexport const DANMU_ING = '正在获取弹幕接口...';\nexport const DANMU_SUCCESS = '获取弹幕接口成功';\nexport const DANMU_FAIL = '获取弹幕接口失败';\nexport const CURRENT_PAGE = '当前页面';\nexport const PUSH_STREAM_END = '已停止推流...';\nexport const RECONNECT_INFO = '自动重连中：';\nexport const INJECTED_SUCCESS = '注入文件：';\n\nexport const DEFAULT_SOCKET = 'http://localhost:8080';\nexport const DEFAULT_RESOLUTION = 720;\nexport const DEFAULT_VIDEO_BITSPER = 2500000;\nexport const DEFAULT_AUDIO_BITSPER = 128000;\nexport const MIME_TYPE = 'video/webm; codecs=\"h264, opus\"';\nexport const RECONNECT_TIME = 100;\nexport const MAX_DANMU = 50;\n\nexport const REG_RTMP = /^rtmp:\\/\\/.+/i;\nexport const REG_HTTP = /^https?:\\/\\/.+/i;\nexport const REG_LIVE = /^https?:\\/\\/live\\.bilibili\\.com/i;\nexport const REG_FUNCTION = /^function\\s*([\\w$]*)\\s*\\(([\\w\\s,$]*)\\)\\s*\\{([\\w\\W\\s\\S]*)\\}$/;\n","import { REG_FUNCTION } from '../../share/constant';\n\nfunction getDanmuOption() {\n    const initTime = Date.now();\n    (function loop() {\n        if (window.DanmakuWebSocket) {\n            const DWS = window.DanmakuWebSocket;\n            window.DanmakuWebSocket = function f(option) {\n                const dws = new DWS(option);\n                window.postMessage({\n                    type: 'danmu_option',\n                    data: Object.keys(option).reduce((obj, key) => {\n                        if (typeof option[key] !== 'function') {\n                            obj[key] = option[key];\n                        }\n                        return obj;\n                    }, {}),\n                });\n                return dws;\n            };\n        } else if (Date.now() - initTime >= 60000) {\n            window.postMessage({\n                type: 'danmu_error',\n            });\n        } else {\n            setTimeout(loop, 10);\n        }\n    })();\n}\n\nclass Danmu {\n    constructor() {\n        const $script = document.createElement('script');\n        $script.type = 'text/javascript';\n        $script.text = getDanmuOption.toString().match(REG_FUNCTION)[3];\n        document.documentElement.appendChild($script);\n        $script.onload = document.documentElement.removeChild($script);\n\n        window.addEventListener('message', event => {\n            chrome.runtime.sendMessage(event.data);\n        });\n    }\n}\n\nexport default new Danmu();\n"],"names":["REG_FUNCTION","getDanmuOption","initTime","Date","now","loop","window","DanmakuWebSocket","DWS","f","option","dws","postMessage","type","data","Object","keys","reduce","obj","key","setTimeout","Danmu","$script","document","createElement","text","toString","match","documentElement","appendChild","onload","removeChild","addEventListener","event","chrome","runtime","sendMessage"],"mappings":";;;EAAA,SAAS,eAAe,CAAC,QAAQ,EAAE,WAAW,EAAE;IAC9C,IAAI,EAAE,QAAQ,YAAY,WAAW,CAAC,EAAE;MACtC,MAAM,IAAI,SAAS,CAAC,mCAAmC,CAAC,CAAC;KAC1D;GACF;;EAED,kBAAc,GAAG,eAAe;;ECyCzB,IAAMA,YAAY,GAAG,6DAArB;;EC7CP,SAASC,cAAT,GAA0B;EACtB,MAAMC,QAAQ,GAAGC,IAAI,CAACC,GAAL,EAAjB;;EACA,GAAC,SAASC,IAAT,GAAgB;EACb,QAAIC,MAAM,CAACC,gBAAX,EAA6B;EACzB,UAAMC,GAAG,GAAGF,MAAM,CAACC,gBAAnB;;EACAD,MAAAA,MAAM,CAACC,gBAAP,GAA0B,SAASE,CAAT,CAAWC,MAAX,EAAmB;EACzC,YAAMC,GAAG,GAAG,IAAIH,GAAJ,CAAQE,MAAR,CAAZ;EACAJ,QAAAA,MAAM,CAACM,WAAP,CAAmB;EACfC,UAAAA,IAAI,EAAE,cADS;EAEfC,UAAAA,IAAI,EAAEC,MAAM,CAACC,IAAP,CAAYN,MAAZ,EAAoBO,MAApB,CAA2B,UAACC,GAAD,EAAMC,GAAN,EAAc;EAC3C,gBAAI,OAAOT,MAAM,CAACS,GAAD,CAAb,KAAuB,UAA3B,EAAuC;EACnCD,cAAAA,GAAG,CAACC,GAAD,CAAH,GAAWT,MAAM,CAACS,GAAD,CAAjB;EACH;;EACD,mBAAOD,GAAP;EACH,WALK,EAKH,EALG;EAFS,SAAnB;EASA,eAAOP,GAAP;EACH,OAZD;EAaH,KAfD,MAeO,IAAIR,IAAI,CAACC,GAAL,KAAaF,QAAb,IAAyB,KAA7B,EAAoC;EACvCI,MAAAA,MAAM,CAACM,WAAP,CAAmB;EACfC,QAAAA,IAAI,EAAE;EADS,OAAnB;EAGH,KAJM,MAIA;EACHO,MAAAA,UAAU,CAACf,IAAD,EAAO,EAAP,CAAV;EACH;EACJ,GAvBD;EAwBH;;MAEKgB,QACF,iBAAc;EAAA;;EACV,MAAMC,OAAO,GAAGC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAhB;EACAF,EAAAA,OAAO,CAACT,IAAR,GAAe,iBAAf;EACAS,EAAAA,OAAO,CAACG,IAAR,GAAexB,cAAc,CAACyB,QAAf,GAA0BC,KAA1B,CAAgC3B,YAAhC,EAA8C,CAA9C,CAAf;EACAuB,EAAAA,QAAQ,CAACK,eAAT,CAAyBC,WAAzB,CAAqCP,OAArC;EACAA,EAAAA,OAAO,CAACQ,MAAR,GAAiBP,QAAQ,CAACK,eAAT,CAAyBG,WAAzB,CAAqCT,OAArC,CAAjB;EAEAhB,EAAAA,MAAM,CAAC0B,gBAAP,CAAwB,SAAxB,EAAmC,UAAAC,KAAK,EAAI;EACxCC,IAAAA,MAAM,CAACC,OAAP,CAAeC,WAAf,CAA2BH,KAAK,CAACnB,IAAjC;EACH,GAFD;EAGH;;AAGL,cAAe,IAAIO,KAAJ,EAAf;;;;;;;;"}