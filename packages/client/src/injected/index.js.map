{"version":3,"file":"index.js","sources":["../../node_modules/_@babel_runtime@7.7.4@@babel/runtime/helpers/classCallCheck.js","../../node_modules/_@babel_runtime@7.7.4@@babel/runtime/helpers/createClass.js","../share/constant.js","dev/index.js"],"sourcesContent":["function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","export const START = 'START';\nexport const STOP = 'STOP';\nexport const DANMU = 'DANMU';\nexport const GIFT = 'GIFT';\nexport const GUARD = 'GUARD';\nexport const CONFIG = 'CONFIG';\nexport const RECORDING = 'RECORDING';\nexport const DEBUG = 'DEBUG';\n","import { DANMU, GIFT, GUARD } from '../../share/constant';\n\nclass Injected {\n    constructor() {\n        if (window.location.href.includes('blh=1')) {\n            this.init();\n        }\n    }\n\n    init() {\n        this.getChatHistoryList().then(chatHistoryList => {\n            const observer = new MutationObserver(mutationsList => {\n                mutationsList.forEach(mutations => {\n                    const addedNodes = Array.from(mutations.addedNodes || []);\n                    addedNodes.forEach(item => {\n                        // 弹幕\n                        if (item.classList.contains('danmaku-item')) {\n                            try {\n                                window.postMessage({\n                                    type: DANMU,\n                                    data: {\n                                        uid: item.dataset.uid,\n                                        uname: item.dataset.uname,\n                                        danmaku: item.dataset.danmaku,\n                                    },\n                                });\n                            } catch (error) {\n                                //\n                            }\n                        }\n\n                        // 礼物\n                        if (item.classList.contains('gift-item')) {\n                            try {\n                                window.postMessage({\n                                    type: GIFT,\n                                    data: {\n                                        uid: null,\n                                        uname: item.querySelector('.username').innerText.trim(),\n                                        action: item.querySelector('.action').innerText.trim(),\n                                        gift: item.querySelector('.gift-name').innerText.trim(),\n                                        count: item.querySelector('.count').innerText.trim(),\n                                    },\n                                });\n                            } catch (error) {\n                                //\n                            }\n                        }\n\n                        // 上船\n                        if (item.classList.contains('guard-buy')) {\n                            try {\n                                window.postMessage({\n                                    type: GUARD,\n                                    data: {\n                                        uid: null,\n                                        uname: item.querySelector('.username').innerText.trim(),\n                                        action: '购买',\n                                        gift: '舰长',\n                                        count: item.querySelector('.count').innerText.trim(),\n                                    },\n                                });\n                            } catch (error) {\n                                //\n                            }\n                        }\n                    });\n                });\n            });\n            observer.observe(chatHistoryList, { childList: true });\n        });\n\n        this.getPenuryGiftMsg().then(penuryGiftMsg => {\n            const observer = new MutationObserver(mutationsList => {\n                mutationsList.forEach(mutations => {\n                    const addedNodes = Array.from(mutations.addedNodes || []);\n                    addedNodes.forEach(item => {\n                        try {\n                            window.postMessage({\n                                type: GIFT,\n                                data: {\n                                    uname: item.querySelector('.username').innerText.trim(),\n                                    action: item.querySelector('.action').innerText.trim(),\n                                    gift: item.querySelector('.gift-name').innerText.trim(),\n                                    count: item.querySelector('.count').innerText.trim(),\n                                },\n                            });\n                        } catch (error) {\n                            //\n                        }\n                    });\n                });\n            });\n            observer.observe(penuryGiftMsg, { childList: true });\n        });\n    }\n\n    getChatHistoryList() {\n        return new Promise(resolve => {\n            (function loop() {\n                const chatHistoryList = document.getElementById('chat-history-list');\n                if (!chatHistoryList) {\n                    setTimeout(loop, 1000);\n                } else {\n                    resolve(chatHistoryList);\n                }\n            })();\n        });\n    }\n\n    getPenuryGiftMsg() {\n        return new Promise(resolve => {\n            (function loop() {\n                const penuryGiftMsg = document.getElementById('penury-gift-msg');\n                if (!penuryGiftMsg) {\n                    setTimeout(loop, 1000);\n                } else {\n                    resolve(penuryGiftMsg);\n                }\n            })();\n        });\n    }\n}\n\nexport default new Injected();\n"],"names":["DANMU","GIFT","GUARD","Injected","window","location","href","includes","init","getChatHistoryList","then","chatHistoryList","observer","MutationObserver","mutationsList","forEach","mutations","addedNodes","Array","from","item","classList","contains","postMessage","type","data","uid","dataset","uname","danmaku","error","querySelector","innerText","trim","action","gift","count","observe","childList","getPenuryGiftMsg","penuryGiftMsg","Promise","resolve","loop","document","getElementById","setTimeout"],"mappings":"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"}