{"version":3,"file":"index.js","sources":["../../node_modules/_@babel_runtime@7.7.4@@babel/runtime/helpers/classCallCheck.js","../../node_modules/_@babel_runtime@7.7.4@@babel/runtime/helpers/createClass.js","../share/constant.js","dev/index.js"],"sourcesContent":["function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","export const START = 'START';\nexport const STOP = 'STOP';\nexport const DANMU = 'DANMU';\nexport const GIFT = 'GIFT';\nexport const GUARD = 'GUARD';\n","import { DANMU, GIFT, GUARD } from '../../share/constant';\n\nclass Injected {\n    constructor() {\n        this.getChatHistoryList().then(chatHistoryList => {\n            const observer = new MutationObserver(mutationsList => {\n                mutationsList.forEach(mutations => {\n                    const addedNodes = Array.from(mutations.addedNodes || []);\n                    addedNodes.forEach(item => {\n                        // 弹幕\n                        if (item.classList.contains('danmaku-item')) {\n                            try {\n                                window.postMessage({\n                                    type: DANMU,\n                                    data: {\n                                        uid: item.dataset.uid,\n                                        uname: item.dataset.uname,\n                                        danmaku: item.dataset.danmaku,\n                                    },\n                                });\n                            } catch (error) {\n                                //\n                            }\n                        }\n\n                        // 礼物\n                        if (item.classList.contains('gift-item')) {\n                            try {\n                                window.postMessage({\n                                    type: GIFT,\n                                    data: {\n                                        uid: null,\n                                        uname: item.dataset('.username').innerText.trim(),\n                                        action: item.querySelector('.action').innerText.trim(),\n                                        gift: item.querySelector('.gift-name').innerText.trim(),\n                                        count: item.querySelector('.count').innerText.trim(),\n                                    },\n                                });\n                            } catch (error) {\n                                //\n                            }\n                        }\n\n                        // 上船\n                        if (item.classList.contains('guard-buy')) {\n                            try {\n                                window.postMessage({\n                                    type: GUARD,\n                                    data: {\n                                        uid: null,\n                                        uname: item.dataset('.username').innerText.trim(),\n                                        action: '购买',\n                                        gift: '舰长',\n                                        count: item.querySelector('.count').innerText.trim(),\n                                    },\n                                });\n                            } catch (error) {\n                                //\n                            }\n                        }\n                    });\n                });\n            });\n            observer.observe(chatHistoryList, { childList: true });\n        });\n\n        this.getPenuryGiftMsg().then(penuryGiftMsg => {\n            const observer = new MutationObserver(mutationsList => {\n                if (mutationsList.length === 1) {\n                    const addedNodes = Array.from(mutationsList[0].addedNodes);\n                    addedNodes.forEach(item => {\n                        try {\n                            window.postMessage({\n                                type: GIFT,\n                                data: {\n                                    uname: item.querySelector('.username').innerText.trim(),\n                                    action: item.querySelector('.action').innerText.trim(),\n                                    gift: item.querySelector('.gift-name').innerText.trim(),\n                                    count: item.querySelector('.count').innerText.trim(),\n                                },\n                            });\n                        } catch (error) {\n                            //\n                        }\n                    });\n                }\n            });\n            observer.observe(penuryGiftMsg, { childList: true });\n        });\n    }\n\n    getChatHistoryList() {\n        return new Promise(resolve => {\n            (function loop() {\n                const chatHistoryList = document.getElementById('chat-history-list');\n                if (!chatHistoryList) {\n                    setTimeout(loop, 1000);\n                } else {\n                    resolve(chatHistoryList);\n                }\n            })();\n        });\n    }\n\n    getPenuryGiftMsg() {\n        return new Promise(resolve => {\n            (function loop() {\n                const penuryGiftMsg = document.getElementById('penury-gift-msg');\n                if (!penuryGiftMsg) {\n                    setTimeout(loop, 1000);\n                } else {\n                    resolve(penuryGiftMsg);\n                }\n            })();\n        });\n    }\n}\n\nexport default new Injected();\n"],"names":["DANMU","GIFT","GUARD","Injected","getChatHistoryList","then","chatHistoryList","observer","MutationObserver","mutationsList","forEach","mutations","addedNodes","Array","from","item","classList","contains","window","postMessage","type","data","uid","dataset","uname","danmaku","error","innerText","trim","action","querySelector","gift","count","observe","childList","getPenuryGiftMsg","penuryGiftMsg","length","Promise","resolve","loop","document","getElementById","setTimeout"],"mappings":"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"}