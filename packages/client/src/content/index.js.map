{"version":3,"file":"index.js","sources":["../../node_modules/@babel/runtime/helpers/classCallCheck.js","../../node_modules/@babel/runtime/helpers/createClass.js","../share/constant.js","dev/index.js"],"sourcesContent":["function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","export const START = 'start';\nexport const STOP = 'stop';\nexport const DANMU = 'danmu';\nexport const GIFT = 'gift';\nexport const GUARD = 'guard';\nexport const CONFIG = 'config';\nexport const RECORDING = 'recording';\nexport const DEBUG = 'debug';\nexport const LOG = 'log';\nexport const ERROR = 'error';\nexport const FAIL = 'fail';\nexport const RTMP = 'rtmp';\nexport const STREAM_DISCONNECT = 'stream_disconnect';\nexport const BINARY_STREAM = 'binary_stream';\nexport const BLH = 'blh';\n\nexport const SOCKET_SUCCESS = '建立socket连接成功';\nexport const SOCKET_FAIL = '建立socket连接失败';\nexport const TAB_VIDEO_STREAM_SUCCESS = '获取标签视频流成功';\nexport const TAB_VIDEO_STREAM_FAIL = '无法获取标签视频流，请重试！';\nexport const RECORDER_SUCCESS = '录制器启动成功';\nexport const RECORDER_FAIL = '无法录制标签的视频流，请重试！';\nexport const PUSH_STREAM_ING = '正在推流中...';\nexport const CAN_NOT_FIND_TAB = '未获取到当前激活的标签';\nexport const RTMP_ERROR = '请输入正确的rtmp推流地址';\nexport const STREAM_NAME_ERROR = '请输入正确的直播码';\nexport const SOCKET_ERROR = '请输入正确的中转地址';\nexport const LIVE_ROOM_ERROR = '不是有效B站直播间地址';\nexport const OPEN_SUCCESS = '打开直播间页面成功，保持该页面打开既可以获取弹幕';\nexport const CURRENT_PAGE = '当前页面';\nexport const PUSH_STREAM_END = '已停止推流...';\n\nexport const DEFAULT_RTMP = 'rtmp://bvc.live-send.acg.tv/live-bvc/';\nexport const DEFAULT_SOCKET = 'http://localhost:8080';\nexport const DEFAULT_RESOLUTION = '1920';\nexport const DEFAULT_BITSPER = '2500000';\n\nexport const REG_RTMP = /^rtmp:\\/\\/.+/i;\nexport const REG_HTTP = /^https?:\\/\\/.+/i;\nexport const REG_LIVE = /^https?:\\/\\/live\\.bilibili\\.com/i;\n","import './index.scss';\nimport { DANMU, GIFT, GUARD } from '../../share/constant';\n\nfunction query(el, doc = document) {\n    return doc.querySelector(el);\n}\n\nclass Content {\n    constructor() {\n        if (!query('.blh-danmuku')) {\n            this.createUI();\n            this.eventBind();\n            this.receiveDanmu();\n        }\n    }\n\n    createUI() {\n        this.manifest = chrome.runtime.getManifest();\n        this.$danmuku = document.createElement('div');\n        this.$danmuku.classList.add('blh-danmuku');\n        this.$danmuku.innerHTML = `\n            <div class=\"blh-header\">\n                <div class=\"blh-header-l\"></div>\n                <div class=\"blh-header-r\">×</div>\n            </div>\n            <div class=\"blh-danmu\">\n                <div class=\"blh-danmu-inner\"></div>\n            </div>\n            <div class=\"blh-gift\">\n                <div class=\"blh-gift-inner\"></div>\n            </div>\n            <div class=\"blh-footer\"></div>\n        `;\n        this.$headL = query('.blh-header-l', this.$danmuku);\n        this.$headR = query('.blh-header-r', this.$danmuku);\n        this.$danmu = query('.blh-danmu', this.$danmuku);\n        this.$danmuInner = query('.blh-danmu-inner', this.$danmuku);\n        this.$gift = query('.blh-gift', this.$danmuku);\n        this.$giftInner = query('.blh-gift-inner', this.$danmuku);\n        this.$footer = query('.blh-footer', this.$danmuku);\n        this.$headL.textContent = `${this.manifest.name} ${this.manifest.version}`;\n        document.body.appendChild(this.$danmuku);\n    }\n\n    eventBind() {\n        let isHeadDroging = false;\n        let isFootDroging = false;\n        let lastPageX = 0;\n        let lastPageY = 0;\n        let lastLeft = 0;\n        let lastTop = 0;\n        let lastHeight = 0;\n\n        this.$headL.addEventListener('mousedown', event => {\n            isHeadDroging = true;\n            lastPageX = event.pageX;\n            lastPageY = event.pageY;\n            lastLeft = this.$danmuku.offsetLeft;\n            lastTop = this.$danmuku.offsetTop;\n        });\n\n        this.$footer.addEventListener('mousedown', event => {\n            isFootDroging = true;\n            lastPageY = event.pageY;\n            lastHeight = this.$danmu.clientHeight;\n        });\n\n        document.addEventListener('mousemove', event => {\n            if (isHeadDroging) {\n                const x = event.pageX - lastPageX;\n                const y = event.pageY - lastPageY;\n                this.$danmuku.style.transform = `translate(${x}px, ${y}px)`;\n            }\n\n            if (isFootDroging) {\n                const height = lastHeight + event.pageY - lastPageY;\n                if (height >= 100) {\n                    this.$danmu.style.height = `${height}px`;\n                } else {\n                    isFootDroging = false;\n                }\n            }\n\n            if (event.composedPath().indexOf(this.$danmuku) > -1) {\n                this.isHover = true;\n            } else {\n                this.isHover = false;\n            }\n        });\n\n        document.addEventListener('mouseup', event => {\n            if (isHeadDroging) {\n                isHeadDroging = false;\n                this.$danmuku.style.transform = 'translate(0, 0)';\n                const x = lastLeft + event.pageX - lastPageX;\n                const y = lastTop + event.pageY - lastPageY;\n                this.$danmuku.style.left = `${x}px`;\n                this.$danmuku.style.top = `${y}px`;\n            }\n\n            if (isFootDroging) {\n                isFootDroging = false;\n            }\n        });\n\n        this.$headR.addEventListener('click', () => {\n            this.$danmuku.classList.add('blh-hidden');\n        });\n    }\n\n    addDanmu(danmu) {\n        const { children } = this.$danmuInner;\n        if (children.length > 50) {\n            const child = children[0];\n            query('.blh-danmu-uname', child).innerText = `${danmu.uname}:`;\n            query('.blh-danmu-text', child).innerText = danmu.text;\n            this.$danmuInner.appendChild(child);\n        } else {\n            this.$danmuInner.insertAdjacentHTML(\n                'beforeend',\n                `\n                <div class=\"blh-danmu-item\">\n                    <span class=\"blh-danmu-uname\">${danmu.uname}:</span>\n                    <span class=\"blh-danmu-text\">${danmu.text}</span>\n                </div>\n            `,\n            );\n        }\n        if (!this.isHover) {\n            this.$danmu.scrollTo(0, this.$danmu.scrollHeight);\n        }\n    }\n\n    addGift(gift) {\n        const { children } = this.$giftInner;\n        if (children.length > 50) {\n            const child = children[0];\n            query('.blh-gift-uname', child).innerText = `${gift.uname}:`;\n            query('.blh-gift-action', child).innerText = gift.action;\n            query('.blh-gift-gift', child).innerText = gift.gift;\n            query('.blh-gift-count', child).innerText = gift.count;\n            this.$giftInner.appendChild(child);\n        } else {\n            this.$giftInner.insertAdjacentHTML(\n                'beforeend',\n                `\n                <div class=\"blh-gift-item\">\n                    <span class=\"blh-gift-uname\">${gift.uname}:</span>\n                    <span class=\"blh-gift-action\">${gift.action}</span>\n                    <span class=\"blh-gift-gift\">${gift.gift}</span>\n                    <span class=\"blh-gift-count\">${gift.count}</span>\n                </div>\n            `,\n            );\n        }\n        if (!this.isHover) {\n            this.$gift.scrollTo(0, this.$gift.scrollHeight);\n        }\n    }\n\n    receiveDanmu() {\n        if (!chrome) return;\n        chrome.runtime.onMessage.addListener(request => {\n            const { type, data } = request;\n            window.postMessage(request);\n            switch (type) {\n                case DANMU:\n                    this.addDanmu(data);\n                    break;\n                case GIFT:\n                case GUARD:\n                    this.addGift(data);\n                    break;\n                default:\n                    break;\n            }\n        });\n    }\n}\n\nexport default new Content();\n"],"names":["DANMU","GIFT","GUARD","query","el","doc","document","querySelector","Content","createUI","eventBind","receiveDanmu","manifest","chrome","runtime","getManifest","$danmuku","createElement","classList","add","innerHTML","$headL","$headR","$danmu","$danmuInner","$gift","$giftInner","$footer","textContent","name","version","body","appendChild","isHeadDroging","isFootDroging","lastPageX","lastPageY","lastLeft","lastTop","lastHeight","addEventListener","event","pageX","pageY","offsetLeft","offsetTop","clientHeight","x","y","style","transform","height","composedPath","indexOf","isHover","left","top","danmu","children","length","child","innerText","uname","text","insertAdjacentHTML","scrollTo","scrollHeight","gift","action","count","onMessage","addListener","request","type","data","window","postMessage","addDanmu","addGift"],"mappings":"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"}